# Требования к внешним интеграциям PropDevelopment

## 1. Общая цель

В рамках развития цифровых сервисов для собственников и жильцов, компания PropDevelopment планирует интеграцию с внешними партнёрскими системами, предоставляющими функции:

- Интеллектуальный домофон (распознавание по лицу, удалённое открытие двери)
- Интеллектуальный шлагбаум (распознавание номера автомобиля, автоматический доступ)

Новые функции должны быть доступны через текущее мобильное приложение собственника.

---

## 2. Требования к безопасности

- Все взаимодействия между системами должны происходить по защищённому протоколу HTTPS с обязательной проверкой TLS-сертификатов.
- Все запросы и ответы должны логироваться с целью аудита.
- Передача персональных данных должна быть строго ограничена и регламентирована согласно 152-ФЗ и GDPR.
- Для каждого партнёра должны использоваться отдельные credentials и scopes (разграничение прав).
- Доступ внешних систем к внутренним ресурсам осуществляется через выделенный API-шлюз (API Gateway) с включённой фильтрацией по IP и rate limiting.
- Необходимо реализовать механизм отзыва доступа (revocation) по требованию или при подозрении на компрометацию.

---

## 3. Аутентификация и авторизация

- Для аутентификации внешних систем используется OAuth 2.0 с использованием client credentials flow.
- Для внутренних сервисов и мобильного приложения применяется OpenID Connect на базе Keycloak.
- Для авторизации используется модель scopes + claims (JWT), поддерживающая разграничение прав доступа на уровне данных.
- Все токены должны быть короткоживущими (access tokens ~10 мин, refresh tokens ~1 час).

---

## 4. Взаимодействие между системами

### Коммуникация:

| Сторона           | Канал взаимодействия | Формат    | Особенности                         |
|-------------------|----------------------|-----------|-------------------------------------|
| Мобильное приложение → API платформы    | HTTPS REST API         | JSON      | Авторизация через Access Token (OIDC) |
| Платформа → партнёрские системы         | HTTPS REST API         | JSON/XML  | OAuth 2.0 client credentials         |
| Партнёрские системы → Платформа         | HTTPS REST Webhook     | JSON      | Подпись запроса, проверка IP         |

---

## 5. Дополнительные меры

- Все внешние вызовы проходят через систему мониторинга (Prometheus + Grafana + Alertmanager).
- Используется Circuit Breaker на уровне API Gateway.
- Ошибки и отклонения логируются в централизованную систему (ELK Stack или Loki).
